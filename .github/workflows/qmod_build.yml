name: qmod_build

on:
  push:
    branches: [ "master" ]
    paths-ignore:
      - '*.md'
      - 'UnityUI'
      - 'CHANGELOG'
  pull_request:
    branches: [ "master" ]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
    
    - uses: seanmiddleditch/gha-setup-ninja@v3

    - name: Create ndkpath.txt
      run: |
        echo "$ANDROID_NDK_LATEST_HOME" > ${GITHUB_WORKSPACE}/ndkpath.txt
        cat ${GITHUB_WORKSPACE}/ndkpath.txt

    - name: Install Dependency without vcpkg
      run: sudo apt install -y libwebsocketpp-dev

    - name: QPM Action
      uses: Fernthedev/qpm-action@v1
      with:
        workflow_token: ${{ secrets.GITHUB_TOKEN }}

        restore: true
        cache: true

    - name: build qmod
      run: |
          cd ${GITHUB_WORKSPACE}
          ls -al
          qpm restore
          pwsh ./scripts/build.ps1 && pwsh ./scripts/createqmod.ps1 -QmodName HeartBeatQuest_1.40.6
          
    - name: echo everything
      run: ls -al
    - uses: actions/upload-artifact@v4
      with:
        name: HeartBeatQuest.qmod
        path: HeartBeatQuest*.qmod
        overwrite: true
